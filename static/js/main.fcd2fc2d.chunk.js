(window["webpackJsonpsorta-cart"]=window["webpackJsonpsorta-cart"]||[]).push([[0],{212:function(e,t,n){e.exports=n(310)},217:function(e,t,n){},310:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(14),i=n.n(c),o=(n(217),n(18)),l=n(182),u=n.n(l),s=n(175),p=n(355),f=n(190),d=n.n(f),m=n(191),g=n.n(m),h=(n(192),n(144)),y=n(179),E=n(356),b=n(353),v=n(352),O=n(169),w=n(149),j=n(145),C=n(167),_=n(150),S=n(171),k=n(132),P=n(163),F=n(177),A=n(174),z=n(178),x=n(189),D=n.n(x),q=n(9),I=n(28),N=n(40),T=n(41),W=n(42),L=n(15);n(309);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var J=new(function(e){function t(){var e;return Object(I.a)(this,t),(e=Object(N.a)(this,Object(T.a)(t).call(this,"SortaCartDatabase"))).cart=void 0,e.version(1).stores({cart:"++id,&product_id"}),e.cart=e.table("cart"),e}return Object(W.a)(t,e),t}(L.a)),G=function(){var e=Object(a.useState)({status:"loading"}),t=Object(o.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){J.cart.toArray().then((function(e){return r({status:"loaded",payload:{line_items:e}})})).catch((function(e){r({status:"error",error:e})})),J.on("changes",(function(e){e.find((function(e){return"cart"===e.table}))&&J.cart.toArray().then((function(e){console.log("[useCartService] db changes!! "),r({status:"loaded",payload:{line_items:e}})})).catch((function(e){r({status:"error",error:e})}))}))}),[]),n},R=function(){return J.cart.count().catch((function(e){return console.warn("[useCartItemCount] caught error:",e),0}))},V=function(){var e=Object(a.useState)(0),t=Object(o.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){R().then((function(e){return r(e)})),J.on("changes",(function(e){e.find((function(e){return"cart"===e.table}))&&R().then((function(e){return r(e)}))}))}),[]),n},$=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(n,!0).forEach((function(t){Object(q.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{product_id:e.id,quantity:1,total:parseFloat(e.ws_price),selected_unit:"CS"});delete t.id,J.cart.add(t).catch((function(e){return console.warn("[addToCart] caught error:",e)}))},H=function(e){J.cart.delete(e).catch((function(e){return console.warn("[removeItemFromCart] caught error:",e)}))},K=function(){J.cart.clear().catch((function(e){console.warn("[emptyCart] caught error:",e)}))},M=function(e){J.cart.update(e.id,e).catch((function(e){return console.warn("[updateLineItem] caught error:",e)}))},Q=.07,U=Object(b.a)((function(e){return Object(v.a)({root:{width:"100%",overflowX:"auto",height:"100%"},table:{maxWidth:"95vw",padding:e.spacing(1),borderCollapse:"separate","& td":{border:"none"}},qtyinput:{width:"50px"}})}));function X(e){return"$".concat("string"===typeof e?parseFloat(e).toFixed(2):e.toFixed(2))}function Y(e){return"EA"===e.selected_unit&&e.u_price?e.quantity*parseFloat(e.u_price):e.quantity*parseFloat(e.ws_price)}function Z(e){var t=U(),n=e.line_items.map((function(e){return e.total})).reduce((function(e,t){return e+t}),0),a=Q*n,c=a+n;return r.a.createElement(k.a,{className:t.root},r.a.createElement(O.a,{className:t.table,"aria-label":"cart"},r.a.createElement(C.a,null,r.a.createElement(_.a,null,r.a.createElement(j.a,{align:"center"}),r.a.createElement(j.a,null,"Description"),r.a.createElement(j.a,{align:"center"},"Price"),r.a.createElement(j.a,{align:"center"},"Unit"),r.a.createElement(j.a,{align:"center"},"Qty."),r.a.createElement(j.a,{align:"center"},"Total"))),r.a.createElement(w.a,null,e.line_items.map((function(e,n){return r.a.createElement(_.a,{key:"li".concat(n)},r.a.createElement(j.a,{align:"center"},r.a.createElement(h.a,{"aria-label":"delete",size:"small",onClick:function(t){return n=e.id,void H(n);var n}},r.a.createElement(D.a,{fontSize:"inherit"}))),r.a.createElement(j.a,null,e.name," ",e.description),r.a.createElement(j.a,{align:"right"},r.a.createElement("div",null,"EA"===e.selected_unit&&e.u_price?X(e.u_price):X(e.ws_price)),r.a.createElement("div",null,function(e){var t=[];return e.pk&&1!==e.pk&&t.push(e.pk),e.size&&t.push(e.size),t.join(" / ")}(e))),r.a.createElement(j.a,{align:"center"},e.u_price&&e.u_price!==e.ws_price?r.a.createElement(A.a,{value:e.selected_unit,onChange:function(t){return function(e,t){e.selected_unit=t,e.total=Y(e),M(e)}(e,t.target.value)},margin:"dense"},r.a.createElement(z.a,{value:"CS"},"Case"),r.a.createElement(z.a,{value:"EA"},"Each")):"CS"===e.unit_type?"Case":"Each"),r.a.createElement(j.a,{align:"right"},r.a.createElement(F.a,{className:t.qtyinput,type:"number",InputLabelProps:{shrink:!0},margin:"dense",fullWidth:!0,value:e.quantity,onChange:function(t){return function(e,t){e.quantity=t>0?t:1,e.total=Y(e),M(e)}(e,t.target.value)},inputProps:{min:"1",step:"1"}})),r.a.createElement(j.a,{align:"right"},X(e.total)))})),r.a.createElement(_.a,null,r.a.createElement(j.a,{rowSpan:3,colSpan:3}),r.a.createElement(j.a,null,"Subtotal"),r.a.createElement(j.a,{align:"center"},e.line_items&&e.line_items.length),r.a.createElement(j.a,{align:"right"},X(n))),r.a.createElement(_.a,null,r.a.createElement(j.a,null,"Tax"),r.a.createElement(j.a,{align:"center"},"".concat((100*Q).toFixed(0)," %")),r.a.createElement(j.a,{align:"right"},X(a))),r.a.createElement(_.a,null,r.a.createElement(j.a,null,"Total"),r.a.createElement(j.a,{align:"right",colSpan:2},r.a.createElement("b",null,X(c))))),r.a.createElement(S.a,null,r.a.createElement(_.a,null,r.a.createElement(j.a,{colSpan:3,align:"left"},r.a.createElement(P.a,{variant:"contained",color:"secondary",onClick:e.emptyCartAndCloseDrawer},"Empty Cart")),r.a.createElement(j.a,{colSpan:3,align:"right"},r.a.createElement(P.a,{variant:"contained",color:"primary"},"Checkout"))))))}var ee=function(e){var t=e.open,n=e.setOpen,a=G();return r.a.createElement(E.a,{anchor:"right",open:t,onClose:function(){return n(!t)}},"loaded"!==a.status&&"Loading...","loaded"===a.status&&a.payload.line_items.length>0&&r.a.createElement(Z,{line_items:a.payload.line_items,emptyCartAndCloseDrawer:function(e){window.confirm("Are you sure?")&&(K(),n(!1))}}))};var te="https://api.marshcoop.org",ne={a:"Artificial ingredients",c:"Low carb",d:"Dairy free",f:"Food Service items",g:"Gluten free",k:"Kosher",l:"Low sodium/no salt",m:"Non-GMO Project Verified",og:"Organic",r:"Refined sugar",v:"Vegan",w:"Wheat free",ft:"Fair Trade",n:"Natural",s:"Specialty Only",y:"Yeast free",1:"100% organic",2:"95%+ organic",3:"70%+ organic"};var ae=function(){var e=V(),t=Object(a.useState)(!1),n=Object(o.a)(t,2),c=n[0],i=n[1],l=Object(a.useState)(!1),f=Object(o.a)(l,2),m=f[0],E=f[1],b={icon:c?"zoom_out":"search",tooltip:c?"Close Search":"Search",isFreeAction:!0,onClick:function(){return i(!c)}},v={icon:function(){return r.a.createElement(p.a,{badgeContent:e,max:99,color:"primary"},r.a.createElement(d.a,null))},tooltip:"Cart",isFreeAction:!0,onClick:function(){return E(!m)}},O=Object(a.useState)([b]),w=Object(o.a)(O,2),j=w[0],C=w[1];Object(a.useEffect)((function(){C(e?[b,v]:[b])}),[c,e]);var _=Object(a.useState)((function(){fetch("".concat(te,"/categories")).then((function(e){return e.json()})).then((function(e){return P(e)}))})),S=Object(o.a)(_,2),k=S[0],P=S[1],F=Object(a.useState)((function(){fetch("".concat(te,"/sub_categories")).then((function(e){return e.json()})).then((function(e){return x(e)}))})),A=Object(o.a)(F,2),z=A[0],x=A[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{columns:[{title:"category",field:"category",type:"string",lookup:k,filterPlaceholder:"filter"},{title:"sub category",field:"sub_category",type:"string",lookup:z,filterPlaceholder:"filter"},{title:"name",field:"name",type:"string",filtering:!1},{title:"description",field:"description",type:"string",filtering:!1},{title:"pk",field:"pk",type:"numeric",filtering:!1},{title:"size",field:"size",type:"string",filtering:!1},{title:"unit type",field:"unit_type",type:"string",lookup:{CS:"Case",EA:"Each"},filterPlaceholder:"filter"},{title:"price",field:"ws_price",type:"currency",filtering:!1},{title:"unit price",field:"u_price",type:"currency",filtering:!1},{title:"properties",field:"codes",type:"string",lookup:ne,filterPlaceholder:"filter",render:function(e){return e.codes.split(", ").map((function(e,t){return ne[e]?r.a.createElement(s.a,{label:ne[e],style:{margin:5},size:"small",key:"pprop".concat(t)}):""}))}},{title:void 0,field:void 0,type:"string",render:function(e){var t="add to shopping cart";return r.a.createElement(y.a,{"aria-label":t,title:t},r.a.createElement(h.a,{color:"primary",onClick:function(){return $(e)}},r.a.createElement(g.a,null)))}},{title:"upc",field:"upc_code",type:"string",hidden:!0},{title:"id",field:"id",type:"string",hidden:!0}],data:function(e){return new Promise((function(t,n){console.log("query:",e),fetch("".concat(te,"/products"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){console.log("result",e),t(e)})).catch((function(e){return console.warn("onoz, caught err:",e),t({data:[],page:0,totalCount:0})}))}))},title:"sorta-cart",options:{headerStyle:{position:"sticky",top:0},maxBodyHeight:"calc(100vh - 133px)",pageSize:50,pageSizeOptions:[50,100,500],debounceInterval:750,filtering:!0,search:c,emptyRowsWhenPaging:!1},actions:j}),r.a.createElement(ee,{open:m,setOpen:E}))},re=function(){return r.a.createElement(ae,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[212,1,2]]]);
//# sourceMappingURL=main.fcd2fc2d.chunk.js.map